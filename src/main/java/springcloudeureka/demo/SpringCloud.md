Spring Cloud
    Spring Cloud封装了Netflix公司开发的Eureka模块来实现服务注册和发现，Eureka采用了C-S的设计架构，
Eureka Server作为服务注册功能的服务器，它是服务注册中心，而系统中的其他微服务，使用Eureka的客户端连接到
Eureka Server，并维持心跳连接。这样系统的维护人员就可以通过Eureka Server来监控系统中各个微服务是否正常运行。

  Eureka由两个组件组成：Eureka服务器和Eureka客户端，Eureka服务器作为服务注册服务器，Eureka客户端是一个Java
客户端，用来简化与服务器的交互，作为轮询负载均衡器，并提供服务的故障支持。


  服务启动后向Eureka注册，Eureka Server 会将注册信息会将其他Eureka Server进行同步，当服务消费者要
调用服务提供者，则向服务注册中心获取服务提供者的地址(即服务应用名，spring.application.name 参数配置)
然后将服务提供者的地址缓存到本地，下次再调用时，则直接从本地缓存中取，完成一次调用。

  当服务注册中心Eureka Server检测到服务提供者因为宕机、网络原因不可用时，则在服务注册中心将服务置为DOWN状态。
并将当前服务提供者状态向订阅者发布，订阅过的服务消费者更新本地缓存。

  服务提供者在启动之后，周期性（默认30秒）向Eureka Server发送心跳，以证明当前服务是可用状态。Eureka Server
在一定的时间（默认为90秒）未收到客户端的心跳，则认为服务宕机，注销该实例。

1.2 Eureka 的自我保护机制
    在默认配置中，Eureka Server在默认90s没有得到客户端的心跳则注销该实例，但是往往因为微服务跨进程调用，
网络通信往往会面临着各种问题，比如微服务状态正常，但是因为网络分区故障时，Eureka Server注销服务实例则会让大部分
微服务不可用，这很危险，因为服务明明没有问题。
    为解决这个问题，Eureka 有自我保护机制，通过Eureka Server配置如下参数，可以启动保护机制。
    eureka.server.enable-self-preservation=true
    它的原理是，当Eureka Server节点在短时间内丢失过多的客户端时（可能发生了网络故障）,那么这个节点将进入自我保护模式，
不再注销任何微服务，当网络故障恢复后，该节点会自动退出保护模式。


1.3 Eureka 高可用集群
    因为服务消费者本地缓存了服务提供者的地址，即使Eureka Server 宕机，也不会影响服务之间的调用，但是一旦新服务上线，
已经在缓存本地的服务提供者不可用了，服务消费者也无法知道，所以保证Eureka Server的高可用还是很有必要的。
    在分布式系统中，任何的地方存在单点，整个体系就不是高可用的，Eureka也一样，在上面的架构图中Eureka Server不是以单点
存在的，而是以集群的方式对外提供服务。

    采用双节点注册中心，若是我们停掉一个注册中心，服务网依然可以正常访问，即实现了服务注册中心的高可用。
 由于服务注册中心之间也相互注册为服务，当服务提供者将嘻嘻注册到一个服务中心，当服务提供者发送注册请求到一个注册中心
 时，注册中心会将该请求转发给集群中相连的其他注册中心，从而实现注册中心之间的服务同步。

 服务续约
    当注册完服务之后，服务提供者会维护一个心跳来持续高速注册中心“我还活着”，以防注册中心将服务实例从服务
列表中排除出去，该操作即为服务续约。默认服务失效时间为90s，调用间隔为30s，注册中心会将每个60s将当前清单中
超过90s没有续约的服务剔除，以防止服务实例因为网络、内存溢出等非正常下线而没有通知注册中心导致调用失败。















